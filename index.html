<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°—Ç—É–¥–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <meta name="theme-color" content="#2c3e50" />
  <style>
    body {
      font-family: 'PT Serif', serif;
      background: #f3f4f6 url('media/bg-paper.png');
      color: #2c3e50;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }

    h1 {
      text-align: center;
      font-size: 2.4rem;
      margin-bottom: 1rem;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      background: #2c3e50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn:hover {
      background: #34495e;
    }

    .result {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
    }

    .subject-list {
      margin-top: 2rem;
    }

    .subject-item {
      background: #e9ecef;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .subject-info {
      flex-grow: 1;
    }

    .gif {
      display: block;
      margin: 1rem auto;
      max-width: 100px;
    }

    .emoji {
      font-size: 1.5rem;
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>üìò –°—Ç—É–¥–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>

  <div class="card">
    <label>–¢–∏–ø –ø—Ä–µ–¥–º–µ—Ç–∞:</label>
    <select id="type">
      <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
      <option value="passfail">–ó–∞—á—ë—Ç</option>
    </select>

    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞:</label>
    <input type="text" id="subject" />

    <div id="exam-fields">
      <label>–†–µ–π—Ç–∏–Ω–≥ (%):</label>
      <input type="number" id="rating" min="0" max="100" />

      <label>–≠–∫–∑–∞–º–µ–Ω (%):</label>
      <input type="number" id="exam" min="0" max="100" />
    </div>

    <div id="passfail-fields" style="display:none;">
      <label>–ó–∞—á—ë—Ç –ø–æ–ª—É—á–µ–Ω?</label>
      <select id="passStatus">
        <option value="pass">‚úÖ –ó–∞—á—ë—Ç</option>
        <option value="fail">‚ùå –ù–µ–∑–∞—á—ë—Ç</option>
      </select>
    </div>

    <button class="btn" onclick="saveSubject()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

    <div class="result" id="result"></div>
    <img id="gif" class="gif" src="" style="display:none;" />
  </div>

  <div class="subject-list" id="subjectList"></div>

  <script>
    let subjects = JSON.parse(localStorage.getItem('subjects') || '[]');
    let editingIndex = null;

    const typeSelect = document.getElementById('type');
    const ratingInput = document.getElementById('rating');
    const examInput = document.getElementById('exam');
    const subjectInput = document.getElementById('subject');
    const passStatus = document.getElementById('passStatus');
    const resultDiv = document.getElementById('result');
    const gif = document.getElementById('gif');

    const examFields = document.getElementById('exam-fields');
    const passfailFields = document.getElementById('passfail-fields');

    typeSelect.addEventListener('change', () => {
      if (typeSelect.value === 'exam') {
        examFields.style.display = 'block';
        passfailFields.style.display = 'none';
      } else {
        examFields.style.display = 'none';
        passfailFields.style.display = 'block';
      }
      resultDiv.textContent = '';
      gif.style.display = 'none';
    });

    function saveSubject() {
      const type = typeSelect.value;
      const subject = subjectInput.value.trim();

      if (!subject) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞');
        return;
      }

      let entry = { type, subject };

      if (type === 'exam') {
        const rating = parseFloat(ratingInput.value);
        const exam = parseFloat(examInput.value);
        if (isNaN(rating) || isNaN(exam)) {
          alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ —ç–∫–∑–∞–º–µ–Ω–∞');
          return;
        }

        const total = Math.round((0.6 * rating) + (0.4 * exam));
        let grade = 2;
        let emoji = "üíÄ";
        let gifPath = "media/fail2.gif";

        if (total > 85) {
          grade = 5;
          emoji = "üéâ";
          gifPath = "media/confetti.gif";
        } else if (total > 65) {
          grade = 4;
          emoji = "üòé";
          gifPath = "media/success4.gif";
        } else if (total > 50) {
          grade = 3;
          emoji = "üôÇ";
          gifPath = "media/neutral3.gif";
        }

        resultDiv.innerHTML = `–û—Ü–µ–Ω–∫–∞: <b>${grade}</b> ${emoji}`;
        gif.src = gifPath;
        gif.style.display = 'block';

        entry = { ...entry, rating, exam, total, grade };
      } else {
        const pass = passStatus.value === 'pass';
        resultDiv.innerHTML = pass ? "–ó–∞—á—ë—Ç ‚úÖ" : "–ù–µ–∑–∞—á—ë—Ç ‚ùå";
        gif.src = pass ? "media/pass.png" : "media/fail.png";
        gif.style.display = 'block';

        entry = { ...entry, pass };
      }

      if (editingIndex !== null) {
        subjects[editingIndex] = entry;
        editingIndex = null;
      } else {
        subjects.push(entry);
      }

      localStorage.setItem('subjects', JSON.stringify(subjects));
      renderSubjects();
      clearForm();
    }

    function editSubject(index) {
      const s = subjects[index];
      editingIndex = index;
      subjectInput.value = s.subject;
      typeSelect.value = s.type;
      typeSelect.dispatchEvent(new Event('change'));

      if (s.type === 'exam') {
        ratingInput.value = s.rating;
        examInput.value = s.exam;
      } else {
        passStatus.value = s.pass ? 'pass' : 'fail';
      }
    }

    function deleteSubject(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?")) {
        subjects.splice(index, 1);
        localStorage.setItem('subjects', JSON.stringify(subjects));
        renderSubjects();
      }
    }

    function clearForm() {
      subjectInput.value = '';
      ratingInput.value = '';
      examInput.value = '';
      resultDiv.textContent = '';
      gif.style.display = 'none';
      typeSelect.value = 'exam';
      typeSelect.dispatchEvent(new Event('change'));
    }

    function renderSubjects() {
      const container = document.getElementById('subjectList');
      container.innerHTML = '';

      subjects.forEach((s, i) => {
        const div = document.createElement('div');
        div.className = 'subject-item';

        let content = `<div class="subject-info"><strong>${s.subject}</strong> (${s.type === 'exam' ? '—ç–∫–∑–∞–º–µ–Ω' : '–∑–∞—á—ë—Ç'})<br/>`;

        if (s.type === 'exam') {
          content += `–û—Ü–µ–Ω–∫–∞: ${s.grade} ${s.total}%`;
        } else {
          content += s.pass ? '–ó–∞—á—ë—Ç ‚úÖ' : '–ù–µ–∑–∞—á—ë—Ç ‚ùå';
        }

        content += '</div>';

        div.innerHTML = content + `
          <div>
            <button class="btn" onclick="editSubject(${i})">‚úèÔ∏è</button>
            <button class="btn" onclick="deleteSubject(${i})">üóë</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    renderSubjects();
  </script>
</body>
</html>

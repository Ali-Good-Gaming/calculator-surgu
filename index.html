<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–°—Ç—É–¥–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="–°—Ç—É–¥–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" />

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      margin: 0;
      background: #f9f9f9 url('media/bg-paper.png');
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app {
      max-width: 500px;
      width: 100%;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    .input-group {
      margin-bottom: 15px;
    }
    .input-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .input-group input, .input-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .btn {
      background-color: #2c3e50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
    }
    .btn:hover {
      background-color: #1a252f;
    }
    .subject-list {
      margin-top: 30px;
    }
    .subject {
      background: #f0f0f0;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .subject .info {
      flex-grow: 1;
    }
    .subject .actions button {
      margin-left: 8px;
    }
    .result {
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }
    .reaction {
      text-align: center;
      margin-top: 15px;
    }
    .reaction img {
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>–°—Ç—É–¥–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>

    <div class="input-group">
      <label>–¢–∏–ø</label>
      <select id="typeSelect" onchange="toggleInputs()">
        <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
        <option value="credit">–ó–∞—á—ë—Ç</option>
      </select>
    </div>

    <div class="input-group">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞</label>
      <input type="text" id="subjectName" />
    </div>

    <div id="examFields">
      <div class="input-group">
        <label>–†–µ–π—Ç–∏–Ω–≥ (0-100)</label>
        <input type="number" id="ratingInput" min="0" max="100" />
      </div>
      <div class="input-group">
        <label>–≠–∫–∑–∞–º–µ–Ω (0-100)</label>
        <input type="number" id="examInput" min="0" max="100" />
      </div>
    </div>

    <div id="creditFields" style="display: none;">
      <div class="input-group">
        <label>–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
        <select id="creditResult">
          <option value="pass">–ó–∞—á—ë—Ç</option>
          <option value="fail">–ù–µ–∑–∞—á—ë—Ç</option>
        </select>
      </div>
    </div>

    <button class="btn" onclick="handleAdd()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>

    <div class="result" id="resultDisplay"></div>
    <div class="reaction" id="reaction"></div>

    <div class="subject-list" id="subjectList"></div>
  </div>

  <script>
    let subjects = JSON.parse(localStorage.getItem("subjects") || "[]");
    let editingIndex = null;

    function toggleInputs() {
      const type = document.getElementById("typeSelect").value;
      document.getElementById("examFields").style.display = type === "exam" ? "block" : "none";
      document.getElementById("creditFields").style.display = type === "credit" ? "block" : "none";
      document.getElementById("resultDisplay").textContent = "";
      document.getElementById("reaction").innerHTML = "";
    }

    function renderSubjects() {
      const list = document.getElementById("subjectList");
      list.innerHTML = "";
      subjects.forEach((s, index) => {
        const el = document.createElement("div");
        el.className = "subject";
        el.innerHTML = `
          <div class="info">
            <strong>${s.name}</strong> (${s.type === "exam" ? s.grade : (s.result === "pass" ? "–ó–∞—á—ë—Ç" : "–ù–µ–∑–∞—á—ë—Ç")})
          </div>
          <div class="actions">
            <button onclick="editSubject(${index})">‚úèÔ∏è</button>
            <button onclick="deleteSubject(${index})">üóë</button>
          </div>`;
        list.appendChild(el);
      });
    }

    function handleAdd() {
      const type = document.getElementById("typeSelect").value;
      const name = document.getElementById("subjectName").value.trim();
      if (!name) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞");

      let newSubject = { name, type };

      if (type === "exam") {
        const rating = +document.getElementById("ratingInput").value;
        const exam = +document.getElementById("examInput").value;
        if (isNaN(rating) || isNaN(exam)) return alert("–í–≤–µ–¥–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥ –∏ —ç–∫–∑–∞–º–µ–Ω");

        const final = (0.6 * rating) + (0.4 * exam);
        let grade = "";
        if (final > 85) grade = "5";
        else if (final > 65) grade = "4";
        else if (final > 50) grade = "3";
        else grade = "2";

        newSubject = { ...newSubject, rating, exam, final, grade };
        showResult(final, grade);
      } else {
        const result = document.getElementById("creditResult").value;
        newSubject.result = result;
        showCreditResult(result);
      }

      if (editingIndex !== null) {
        subjects[editingIndex] = newSubject;
        editingIndex = null;
      } else {
        subjects.push(newSubject);
      }

      localStorage.setItem("subjects", JSON.stringify(subjects));
      renderSubjects();
      resetForm();
    }

    function showResult(final, grade) {
      const result = document.getElementById("resultDisplay");
      result.textContent = –ò—Ç–æ–≥: ${final.toFixed(1)}% ‚Üí –û—Ü–µ–Ω–∫–∞: ${grade};
      const reaction = document.getElementById("reaction");
      const map = {
        "5": "confetti.gif",
        "4": "success4.gif",
        "3": "neutral3.gif",
        "2": "fail2.gif"
      };
      reaction.innerHTML = <img src="media/${map[grade]}" alt="gif" />;
    }

    function showCreditResult(result) {
      const reaction = document.getElementById("reaction");
      const src = result === "pass" ? "pass.png" : "fail.png";
      reaction.innerHTML = <img src="media/${src}" alt="credit" />;
      document.getElementById("resultDisplay").textContent = result === "pass" ? "–ó–∞—á—ë—Ç –ø–æ–ª—É—á–µ–Ω ‚úÖ" : "–ù–µ–∑–∞—á—ë—Ç ‚ùå";
    }

    function resetForm() {
      document.getElementById("subjectName").value = "";
      document.getElementById("ratingInput").value = "";
      document.getElementById("examInput").value = "";
      document.getElementById("creditResult").value = "pass";
      toggleInputs();
    }

    function deleteSubject(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç?")) {
        subjects.splice(index, 1);
        localStorage.setItem("subjects", JSON.stringify(subjects));
        renderSubjects();
      }
    }

    function editSubject(index) {
      const s = subjects[index];
      editingIndex = index;
      document.getElementById("subjectName").value = s.name;
      document.getElementById("typeSelect").value = s.type;
      toggleInputs();
      if (s.type === "exam") {
        document.getElementById("ratingInput").value = s.rating;
        document.getElementById("examInput").value = s.exam;
      } else {
        document.getElementById("creditResult").value = s.result;
      }
    }

    // Init
    renderSubjects();
    toggleInputs();
  </script>
</body>
</html>
